<?xml version="1.0" encoding="UTF-8"?>
<project name="WebApp.makejar" default="makejar" basedir=".">
  <property name="tomcat.dir" value="c:/bin/tomcat8/webapps"/>
<!-- This does not work, WHY????
	<scriptdef name="envproperty" language="javascript">
	    <attribute name="name" />
	    <attribute name="fromenv" />
	<![CDATA[
	    importClass( java.lang.System );
	    project.setProperty(
	        attributes.get( "name" ),
	        System.getenv( attributes.get( "fromenv" ) )
	    );
	]]> 
	</scriptdef>
	<envproperty name="tomcat.dir" fromenv="TOMCAT"/> -->
  <!-- <property name="tomcat.dir" value="TOMCAT"/> -->
  <target name ="makejar" description="Create a jar for the HW project">
    <jar jarfile="quiz.jar" includes="*.class" basedir="bin"/>
    <echo>Copying jar into dist</echo>
    <copy todir="${tomcat.dir}/quiz/WEB-INF/lib">
    	<fileset file="${basedir}/quiz.jar"/>	
    </copy>
    <copy todir="${tomcat.dir}/quiz/">
    	<fileset file="${basedir}/web/*.jsp"/>	
    </copy>
  </target>
	
  <target name="setup">
	<mkdir dir="dist" />
    <echo>Copying web into dist</echo>
    <copydir dest="dist/web" src="web" />
	<copydir dest="dist/web/WEB-INF/lib" src="${basedir}/web/WEB-INF/lib" />
  </target>

  <target name="compile">
	    <delete dir="${dist.dir}/web/WEB-INF/classes" />
	    <mkdir dir="${dist.dir}/web/WEB-INF/classes" />
	    <javac destdir="${dist.dir}/web/WEB-INF/classes" srcdir="src">
	        <classpath>
	            <fileset dir="${basedir}/../web/WEB-INF/lib">
	                  <include name="*" />
	            </fileset>
	        </classpath>
	    </javac>
	    <copy todir="${dist.dir}/web/WEB-INF/classes">
	        <fileset dir="src">
	            <include name="**/*.properties" />
	            <include name="**/*.xml" />
	        </fileset>
	    </copy>
  </target>


  <target name="buildwar">
	    <war basedir="${basedir}/dist/web" destfile="My.war"
	     webxml="${basedir}/dist/web/WEB-INF/web.xml">
	        <exclude name="WEB-INF/**" />
	        <webinf dir="${basedir}/dist/web/WEB-INF/">
	            <include name="**/*.jar" />
	        </webinf>
	    </war>
  </target>
	
	
</project>